Running Start

> hdx-adapter@1.1.0 start /opt/hdx-index-adapter
> NODE_PATH=app/src node $NODE_DEBUG_OPTION app/index.js

{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Initializing cron","time":"2018-12-10T22:25:52.036Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":20,"msg":"Loading routes...","time":"2018-12-10T22:25:52.059Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":20,"msg":"Loading route /opt/hdx-index-adapter/app/src/routes/api/v1/hdx.router.js, in path /api/v1","time":"2018-12-10T22:25:52.060Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":20,"msg":"Loaded routes correctly!","time":"2018-12-10T22:25:52.084Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Server started in  3012","time":"2018-12-10T22:25:52.088Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Initializing register microservice","time":"2018-12-10T22:25:52.090Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":20,"msg":"Checking mode","time":"2018-12-10T22:25:52.090Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":20,"msg":"Register microservice complete succesfully!","time":"2018-12-10T22:25:52.302Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Running cron update","time":"2018-12-10T22:27:00.113Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":20,"msg":"Obtaining datasets","time":"2018-12-10T22:27:00.113Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Adding authentication header ","time":"2018-12-10T22:27:01.330Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Adding authentication header ","time":"2018-12-10T22:27:07.419Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Adding authentication header ","time":"2018-12-10T22:27:07.626Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":20,"msg":"hdx csv rows 154","time":"2018-12-10T22:27:08.826Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":20,"msg":"api highways csv rows 153","time":"2018-12-10T22:27:08.826Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":40,"msg":"Dataset fts_requirements_funding_cluster_yem.csv with id 6dfca3e5-bac6-48a0-a602-74bd2444d8c2 exists, but data is corrupted...Deleting and re-adding","time":"2018-12-10T22:27:08.827Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Adding authentication header ","time":"2018-12-10T22:27:08.827Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":20,"msg":"Adding dataset fts_requirements_funding_cluster_yem.csv","time":"2018-12-10T22:27:09.597Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Adding authentication header ","time":"2018-12-10T22:27:09.597Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":20,"msg":"new dataset","time":"2018-12-10T22:27:09.670Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":20,"data":{"id":"ad67f6ef-8275-49fa-95e6-c12f3b49bcda","type":"dataset","attributes":{"name":"fts_requirements_funding_cluster_yem.csv","slug":"fts_requirements_funding_cluster_yemcsv_7","type":null,"dataPath":null,"attributesPath":null,"connectorType":"document","provider":"csv","userId":"microservice","connectorUrl":"http://data.humdata.org/dataset/d3657fc6-8cf9-45a0-94e0-306ed741ae4a/resource/f97cfa16-7b3e-4ef0-a65e-f05cabe5f9c8/download/fts_requirements_funding_cluster_yem.csv","tableName":null,"status":"pending","published":false,"sandbox":false,"overwrite":false,"verified":false,"blockchain":{},"subscribable":{},"env":"production","geoInfo":false,"protected":false,"legend":{"date":[],"region":[],"country":[],"nested":[]},"clonedHost":{},"errorMessage":null,"taskId":null,"createdAt":"2018-12-10T22:27:09.626Z","updatedAt":"2018-12-10T22:27:09.626Z"}},"msg":"","time":"2018-12-10T22:27:09.670Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Adding authentication header ","time":"2018-12-10T22:27:09.670Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":20,"msg":"Sleeping...","time":"2018-12-10T22:27:09.695Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Adding authentication header ","time":"2018-12-10T22:27:13.700Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":20,"msg":"Sleeping...","time":"2018-12-10T22:27:13.723Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Adding authentication header ","time":"2018-12-10T22:27:17.725Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":20,"msg":"Sleeping...","time":"2018-12-10T22:27:17.749Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Adding authentication header ","time":"2018-12-10T22:27:21.754Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":20,"msg":"Sleeping...","time":"2018-12-10T22:27:21.782Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Adding authentication header ","time":"2018-12-10T22:27:25.784Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":20,"msg":"Sleeping...","time":"2018-12-10T22:27:25.817Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Adding authentication header ","time":"2018-12-10T22:27:29.817Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":20,"msg":"Sleeping...","time":"2018-12-10T22:27:29.845Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Adding authentication header ","time":"2018-12-10T22:27:33.850Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":20,"msg":"Sleeping...","time":"2018-12-10T22:27:33.875Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Adding authentication header ","time":"2018-12-10T22:27:37.877Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":20,"msg":"Sleeping...","time":"2018-12-10T22:27:37.915Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Adding authentication header ","time":"2018-12-10T22:27:41.920Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":20,"msg":"dataset saved - updating vocab/tags","time":"2018-12-10T22:27:41.948Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Adding authentication header ","time":"2018-12-10T22:27:41.948Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Adding authentication header ","time":"2018-12-10T22:27:43.591Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Adding authentication header ","time":"2018-12-10T22:27:43.705Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":50,"msg":"Error in cron update { StatusCodeError: 403 - {\"errors\":[{\"status\":403,\"detail\":\"Forbidden\"}]}\n    at new StatusCodeError (/opt/hdx-index-adapter/node_modules/request-promise-core/lib/errors.js:32:15)\n    at Request.plumbing.callback (/opt/hdx-index-adapter/node_modules/request-promise-core/lib/plumbing.js:104:33)\n    at Request.RP$callback [as _callback] (/opt/hdx-index-adapter/node_modules/request-promise-core/lib/plumbing.js:46:31)\n    at Request.self.callback (/opt/hdx-index-adapter/node_modules/request/request.js:185:22)\n    at emitTwo (events.js:106:13)\n    at Request.emit (events.js:192:7)\n    at Request.<anonymous> (/opt/hdx-index-adapter/node_modules/request/request.js:1157:10)\n    at emitOne (events.js:96:13)\n    at Request.emit (events.js:189:7)\n    at IncomingMessage.<anonymous> (/opt/hdx-index-adapter/node_modules/request/request.js:1079:12)\n    at Object.onceWrapper (events.js:291:19)\n    at emitNone (events.js:91:20)\n    at IncomingMessage.emit (events.js:186:7)\n    at endReadableNT (_stream_readable.js:974:12)\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\n    at process._tickCallback (internal/process/next_tick.js:98:9)\n  name: 'StatusCodeError',\n  statusCode: 403,\n  message: '403 - {\"errors\":[{\"status\":403,\"detail\":\"Forbidden\"}]}',\n  error: { errors: [ [Object] ] },\n  options: \n   { method: 'GET',\n     uri: 'http://control-tower.default.svc.cluster.local/v1/query?sql=select%20*%20from%2074744bb5-7834-4745-ac9a-6e9ecb3bc313&format=csv',\n     json: true,\n     headers: { authentication: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6Im1pY3Jvc2VydmljZSIsImNyZWF0ZWRBdCI6IjIwMTYtMDktMTQifQ.jCSnKspzGsG9TmIcDDOTFuLOhik5TykvsECZ1eXp-1k' },\n     callback: [Function: RP$callback],\n     transform: undefined,\n     simple: true,\n     resolveWithFullResponse: false,\n     transform2xxOnly: false },\n  response: \n   IncomingMessage {\n     _readableState: \n      ReadableState {\n        objectMode: false,\n        highWaterMark: 16384,\n        buffer: [Object],\n        length: 0,\n        pipes: null,\n        pipesCount: 0,\n        flowing: true,\n        ended: true,\n        endEmitted: true,\n        reading: false,\n        sync: true,\n        needReadable: false,\n        emittedReadable: false,\n        readableListening: false,\n        resumeScheduled: false,\n        defaultEncoding: 'utf8',\n        ranOut: false,\n        awaitDrain: 0,\n        readingMore: false,\n        decoder: null,\n        encoding: null },\n     readable: false,\n     domain: null,\n     _events: \n      { end: [Object],\n        close: [Object],\n        data: [Function],\n        error: [Function] },\n     _eventsCount: 4,\n     _maxListeners: undefined,\n     socket: \n      Socket {\n        connecting: false,\n        _hadError: false,\n        _handle: null,\n        _parent: null,\n        _host: 'control-tower.default.svc.cluster.local',\n        _readableState: [Object],\n        readable: false,\n        domain: null,\n        _events: [Object],\n        _eventsCount: 8,\n        _maxListeners: undefined,\n        _writableState: [Object],\n        writable: false,\n        allowHalfOpen: false,\n        destroyed: true,\n        _bytesDispatched: 351,\n        _sockname: null,\n        _pendingData: null,\n        _pendingEncoding: '',\n        server: null,\n        _server: null,\n        parser: null,\n        _httpMessage: [Object],\n        read: [Function],\n        _consuming: true,\n        _idleNext: null,\n        _idlePrev: null,\n        _idleTimeout: -1 },\n     connection: \n      Socket {\n        connecting: false,\n        _hadError: false,\n        _handle: null,\n        _parent: null,\n        _host: 'control-tower.default.svc.cluster.local',\n        _readableState: [Object],\n        readable: false,\n        domain: null,\n        _events: [Object],\n        _eventsCount: 8,\n        _maxListeners: undefined,\n        _writableState: [Object],\n        writable: false,\n        allowHalfOpen: false,\n        destroyed: true,\n        _bytesDispatched: 351,\n        _sockname: null,\n        _pendingData: null,\n        _pendingEncoding: '',\n        server: null,\n        _server: null,\n        parser: null,\n        _httpMessage: [Object],\n        read: [Function],\n        _consuming: true,\n        _idleNext: null,\n        _idlePrev: null,\n        _idleTimeout: -1 },\n     httpVersionMajor: 1,\n     httpVersionMinor: 1,\n     httpVersion: '1.1',\n     complete: true,\n     headers: \n      { vary: 'Origin',\n        'content-type': 'text/csv',\n        'x-response-time': '39 ms',\n        'content-length': '48',\n        date: 'Mon, 10 Dec 2018 22:27:43 GMT',\n        connection: 'close' },\n     rawHeaders: \n      [ 'Vary',\n        'Origin',\n        'content-type',\n        'text/csv',\n        'X-Response-Time',\n        '39 ms',\n        'Content-Length',\n        '48',\n        'Date',\n        'Mon, 10 Dec 2018 22:27:43 GMT',\n        'Connection',\n        'close' ],\n     trailers: {},\n     rawTrailers: [],\n     upgrade: false,\n     url: '',\n     method: null,\n     statusCode: 403,\n     statusMessage: 'Forbidden',\n     client: \n      Socket {\n        connecting: false,\n        _hadError: false,\n        _handle: null,\n        _parent: null,\n        _host: 'control-tower.default.svc.cluster.local',\n        _readableState: [Object],\n        readable: false,\n        domain: null,\n        _events: [Object],\n        _eventsCount: 8,\n        _maxListeners: undefined,\n        _writableState: [Object],\n        writable: false,\n        allowHalfOpen: false,\n        destroyed: true,\n        _bytesDispatched: 351,\n        _sockname: null,\n        _pendingData: null,\n        _pendingEncoding: '',\n        server: null,\n        _server: null,\n        parser: null,\n        _httpMessage: [Object],\n        read: [Function],\n        _consuming: true,\n        _idleNext: null,\n        _idlePrev: null,\n        _idleTimeout: -1 },\n     _consuming: true,\n     _dumped: false,\n     req: \n      ClientRequest {\n        domain: null,\n        _events: [Object],\n        _eventsCount: 5,\n        _maxListeners: undefined,\n        output: [],\n        outputEncodings: [],\n        outputCallbacks: [],\n        outputSize: 0,\n        writable: true,\n        _last: true,\n        upgrading: false,\n        chunkedEncoding: false,\n        shouldKeepAlive: false,\n        useChunkedEncodingByDefault: false,\n        sendDate: false,\n        _removedHeader: {},\n        _contentLength: 0,\n        _hasBody: true,\n        _trailer: '',\n        finished: true,\n        _headerSent: true,\n        socket: [Object],\n        connection: [Object],\n        _header: 'GET /v1/query?sql=select%20*%20from%2074744bb5-7834-4745-ac9a-6e9ecb3bc313&format=csv HTTP/1.1\\r\\nauthentication: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6Im1pY3Jvc2VydmljZSIsImNyZWF0ZWRBdCI6IjIwMTYtMDktMTQifQ.jCSnKspzGsG9TmIcDDOTFuLOhik5TykvsECZ1eXp-1k\\r\\nhost: control-tower.default.svc.cluster.local\\r\\naccept: application/json\\r\\nConnection: close\\r\\n\\r\\n',\n        _headers: [Object],\n        _headerNames: [Object],\n        _onPendingData: null,\n        agent: [Object],\n        socketPath: undefined,\n        timeout: undefined,\n        method: 'GET',\n        path: '/v1/query?sql=select%20*%20from%2074744bb5-7834-4745-ac9a-6e9ecb3bc313&format=csv',\n        _ended: true,\n        res: [Circular],\n        aborted: undefined,\n        timeoutCb: null,\n        upgradeOrConnect: false,\n        parser: null,\n        maxHeadersCount: null },\n     request: \n      Request {\n        domain: null,\n        _events: [Object],\n        _eventsCount: 5,\n        _maxListeners: undefined,\n        method: 'GET',\n        uri: [Object],\n        headers: [Object],\n        readable: true,\n        writable: true,\n        explicitMethod: true,\n        _qs: [Object],\n        _auth: [Object],\n        _oauth: [Object],\n        _multipart: [Object],\n        _redirect: [Object],\n        _tunnel: [Object],\n        _rp_resolve: [Function],\n        _rp_reject: [Function],\n        _rp_promise: [Object],\n        _rp_callbackOrig: undefined,\n        callback: [Function],\n        _rp_options: [Object],\n        setHeader: [Function],\n        hasHeader: [Function],\n        getHeader: [Function],\n        removeHeader: [Function],\n        localAddress: undefined,\n        pool: {},\n        dests: [],\n        __isRequestRequest: true,\n        _callback: [Function: RP$callback],\n        proxy: null,\n        tunnel: false,\n        setHost: true,\n        originalCookieHeader: undefined,\n        _disableCookies: true,\n        _jar: undefined,\n        port: 80,\n        host: 'control-tower.default.svc.cluster.local',\n        path: '/v1/query?sql=select%20*%20from%2074744bb5-7834-4745-ac9a-6e9ecb3bc313&format=csv',\n        _json: true,\n        httpModule: [Object],\n        agentClass: [Object],\n        agent: [Object],\n        _started: true,\n        href: 'http://control-tower.default.svc.cluster.local/v1/query?sql=select%20*%20from%2074744bb5-7834-4745-ac9a-6e9ecb3bc313&format=csv',\n        req: [Object],\n        ntick: true,\n        response: [Circular],\n        originalHost: 'control-tower.default.svc.cluster.local',\n        originalHostHeaderName: 'host',\n        responseContent: [Circular],\n        _destdata: true,\n        _ended: true,\n        _callbackCalled: true },\n     toJSON: [Function: responseToJSON],\n     caseless: Caseless { dict: [Object] },\n     read: [Function],\n     body: { errors: [Object] } } }","time":"2018-12-10T22:27:43.765Z","v":0}
(node:16) UnhandledPromiseRejectionWarning: Unhandled promise rejection (rejection id: 1): StatusCodeError: 403 - {"errors":[{"status":403,"detail":"Forbidden"}]}
(node:16) DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.
  <-- GET /info
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Entering with path /info","time":"2018-12-10T22:29:29.097Z","v":0}
{"name":"hdx-index-adapter","hostname":"hdx-adapter-dd64b49f-5w7bg","pid":16,"level":30,"msg":"Obtaining info to register microservice","time":"2018-12-10T22:29:29.097Z","v":0}
  --> GET /info 200 8ms 1.62kb
